<form [formGroup]="beneficiaryForm" #formGroupDirective="ngForm" (ngSubmit)="addBeneficiary(beneficiaryForm, formGroupDirective)">

  <h3>Beneficiary Owner Details</h3>

  <div fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

    <mat-form-field fxFlex="48%">
      <mat-label>ID Number</mat-label>
      <input matInput type="number" required formControlName="idNumber">
      <mat-error *ngIf="beneficiaryForm.controls.idNumber.hasError('required')">
        ID Number is <strong>required</strong>
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.idNumber.hasError('pattern')">
        Enter valid 13 digit ID Number
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.idNumber.hasError('duplicate')">
        Beneficiary with ID Number already added
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>First Name</mat-label>
      <input matInput required formControlName="firstName">
      <mat-error *ngIf="beneficiaryForm.controls.firstName.hasError('required')">
        First Name is <strong>required</strong>
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.firstName.hasError('pattern')">
        Enter valid first name
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Middle Name</mat-label>
      <input matInput formControlName="middleName">
      <mat-error *ngIf="beneficiaryForm.controls.middleName.hasError('pattern')">
        Enter valid middle name
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Last Name</mat-label>
      <input matInput required formControlName="lastName">
      <mat-error *ngIf="beneficiaryForm.controls.lastName.hasError('required')">
        Last Name is <strong>required</strong>
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.lastName.hasError('pattern')">
        Enter valid last name
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Ownership/Control in %</mat-label>
      <input matInput type="number" required formControlName="ownership">
      <mat-error *ngIf="beneficiaryForm.controls.ownership.hasError('required')">
        Ownership/Control is <strong>required</strong>
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.ownership.hasError('pattern')">
        Enter valid percentage value
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.ownership.hasError('min')">
        Enter valid percentage value between 0.01 and 100
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.ownership.hasError('max')">
        Enter valid percentage value between 0.01 and 100
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Tax Identification Number (TIN)</mat-label>
      <input matInput required formControlName="tin">
      <mat-error *ngIf="beneficiaryForm.controls.tin.hasError('required')">
        Tax Identification Number is <strong>required</strong>
      </mat-error>
      <mat-error *ngIf="beneficiaryForm.controls.tin.hasError('duplicate')">
        Beneficiary with Tax Identification Number already added
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Source of funds</mat-label>
      <mat-select required formControlName="sourceOfFundsId">
        <mat-option *ngFor="let source of sourceOfFundsOptions" [value]="source.id">
          {{ source.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="beneficiaryForm.controls.sourceOfFundsId.hasError('required')">
        Source of funds is <strong>required</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Source of wealth</mat-label>
      <mat-select required formControlName="sourceOfWealthId">
        <mat-option *ngFor="let source of sourceOfWealthOptions" [value]="source.id">
          {{ source.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="beneficiaryForm.controls.sourceOfWealthId.hasError('required')">
        Source of wealth is <strong>required</strong>
      </mat-error>
    </mat-form-field>

  </div>

  <h3>Beneficiary Owner Address</h3>

  <div fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

    <mat-form-field fxFlex="48%">
      <mat-label>Street</mat-label>
      <input matInput formControlName="street">
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Town / Village</mat-label>
      <input matInput required formControlName="town">
      <mat-error *ngIf="beneficiaryForm.controls.town.hasError('required')">
        Town / Village is <strong>required</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>City</mat-label>
      <input matInput required formControlName="city">
      <mat-error *ngIf="beneficiaryForm.controls.city.hasError('required')">
        City is <strong>required</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>State / Province</mat-label>
      <mat-select required formControlName="stateId">
        <mat-option *ngFor="let state of stateOptions" [value]="state.id">
          {{ state.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="beneficiaryForm.controls.stateId.hasError('required')">
        State / Province is <strong>required</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Country</mat-label>
      <mat-select required formControlName="countryId">
        <mat-option *ngFor="let country of countryOptions" [value]="country.id">
          {{ country.name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="beneficiaryForm.controls.countryId.hasError('required')">
        country is <strong>required</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>Postal Code</mat-label>
      <input matInput formControlName="postalCode">
    </mat-form-field>
  </div>

  <div fxLayout="row" fxLayoutAlign="flex-end" class="m-b-20 margin-t" fxLayoutGap="2%">
    <button mat-raised-button color="primary" type="submit">
      <fa-icon icon="plus"></fa-icon>&nbsp;&nbsp;{{editingBeneficiary ? 'Save' : 'Add Beneficiary Owner'}}
    </button>
  </div>
</form>

  <h3>Added Beneficiary Owners</h3>

  <mat-accordion>

    <mat-expansion-panel *ngFor="let beneficiary of beneficiariesOwnerData; index as i" class="beneficiary">

      <mat-expansion-panel-header>

        <mat-panel-title>
          {{i+1}}. {{beneficiary.firstName}} {{beneficiary.middleName}} {{beneficiary.lastName}}
        </mat-panel-title>

      </mat-expansion-panel-header>

      <mat-divider></mat-divider>

      <div class="beneficiary-actions" fxLayout="row" fxLayoutAlign="flex-end center">
        <button mat-button color="primary" (click)="editBeneficiary(beneficiary,i)">
          <fa-icon icon="edit"></fa-icon>
        </button>
        <button mat-button color="warn" (click)="deleteBeneficiary(beneficiary,i)">
          <fa-icon icon="trash"></fa-icon>
        </button>
      </div>

      <p>
        <span>ID Number : <strong>{{beneficiary.idNumber}}</strong> <br /></span>
        <span>Ownership / Control : <strong>{{beneficiary.ownership}}%</strong> <br /></span>
        <span>Tax Identification Number : <strong>{{beneficiary.tin}}</strong><br /></span>
        <span>Source of funds : <strong>{{getSelectedSourceOfFundsValue(beneficiary.sourceOfFundsId)?.name}}</strong><br /></span>
        <span>Source of wealth : <strong>{{getSelectedSourceOfWealthValue(beneficiary.sourceOfWealthId)?.name}}</strong><br /></span>
        <span>Address : <strong>{{beneficiary.street}} {{beneficiary.town}} {{beneficiary.city}}
          {{getSelectedState(beneficiary.stateId)?.name}} {{getSelectedCountry(beneficiary.countryId)?.name}} {{beneficiary.postalCode}}</strong><br /></span>
      </p>

    </mat-expansion-panel>

  </mat-accordion>

  <div fxLayout="row" class="margin-t" fxLayout.xs="column" fxLayoutAlign="center">
    <button mat-raised-button matStepperPrevious>
      <fa-icon icon="arrow-left"></fa-icon>&nbsp;&nbsp;
      Previous
    </button>
    <button mat-raised-button matStepperNext>
      Next&nbsp;&nbsp;
      <fa-icon icon="arrow-right"></fa-icon>
    </button>
  </div>

